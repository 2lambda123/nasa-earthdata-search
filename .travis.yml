language: ruby
cache:
  bundler: true
  directories:
    - node_modules
sudo: required
dist: trusty
before_install:
  - sudo add-apt-repository --yes ppa:beineri/opt-qt551-trusty
  - sudo apt-get update -qq
install:
  - sudo apt-get -y install qt55[QTPACKAGE]
script:
  - source /opt/qt55/bin/qt55-env.sh
  - cd src
  - /opt/qt55/bin/qmake -project
  - /opt/qt55/bin/qmake KBBI-Qt.pro
  - make
  - bundle exec bin/setup
  - bundle exec rake travis:ci
#addons:
#  apt:
#    sources:
#      - ubuntu-sdk-team
#    packages:
#      - libqt5webkit5-dev
#      - qtdeclarative5-dev
#after_failure:
#  - cat ./log/test.log
env:
  global:
    - CI_NODE_TOTAL=4
  matrix:
    - CI_NODE_INDEX=0
    - CI_NODE_INDEX=1
    - CI_NODE_INDEX=2
    - CI_NODE_INDEX=3
    - JASMINE=true
branches:
  only: # Only build master. Pull requests to master also get built.
    - master
deploy:
  provider: script
  script: bin/ecc-sync
  on:
    branch: master
    repo: nasa/earthdata-search
